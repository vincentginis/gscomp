<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Google Scholar Citation Comparer</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 20px auto;
      text-align: center;
    }
    .inputs {
      margin-bottom: 10px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Compare Google Scholar Citations</h2>
<div class="inputs">
  <label>Scholar User ID 1: <input type="text" id="profile1" placeholder="e.g. RBC9W6AAAAAJ"></label>
</div>
<div class="inputs">
  <label>Scholar User ID 2: <input type="text" id="profile2" placeholder="e.g. IjN9W6AAAAAJ"></label>
</div>
<button onclick="compareCitations()">Compare</button>

<div class="result" id="resultArea"></div>

<script>
async function fetchCitationCount(userId) {
  const url = `https://scholar.google.com/citations?user=${encodeURIComponent(userId)}`;
  
  try {
    const response = await fetch(url, {
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Accept-Language': 'en-US,en;q=0.9',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
        'Connection': 'keep-alive'
      }
    });

    if (!response.ok) {
      console.error(`HTTP error: ${response.status}`);
      return null;
    }

    const html = await response.text();

    // Parse the "Cited by" count dynamically
    const match = html.match(/<td[^>]*class="gsc_rsb_std"[^>]*>(\d+)<\/td>/);
    if (match && match[1]) {
      return parseInt(match[1], 10);
    }

    console.error("Could not parse citation count.");
    return null;
  } catch (error) {
    console.error("Error fetching citation count:", error);
    return null;
  }
}

async function compareCitations() {
  const profileId1 = document.getElementById("profile1").value.trim();
  const profileId2 = document.getElementById("profile2").value.trim();

  if (!profileId1 || !profileId2) {
    document.getElementById("resultArea").innerText = "Enter both user IDs.";
    return;
  }

  // Display loading message
  document.getElementById("resultArea").innerText = "Fetching data...";

  // Fetch citation counts
  const [count1, count2] = await Promise.all([
    fetchCitationCount(profileId1),
    fetchCitationCount(profileId2)
  ]);

  // Handle cases where fetching fails
  if (count1 === null || count2 === null) {
    document.getElementById("resultArea").innerText =
      "Could not retrieve one or both citation counts (possibly blocked by Google or incorrect IDs).";
    return;
  }

  // Display results
  let resultText = `Profile 1 (ID: ${profileId1}) Citations: ${count1}\n` +
                   `Profile 2 (ID: ${profileId2}) Citations: ${count2}\n\n`;

  if (count1 > count2) {
    resultText += "Profile 1 has more citations.";
  } else if (count2 > count1) {
    resultText += "Profile 2 has more citations.";
  } else {
    resultText += "They have the same number of citations.";
  }

  document.getElementById("resultArea").innerText = resultText;
}
</script>

</body>
</html>
